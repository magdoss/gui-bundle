{% extends "GuiBundle::base.html.twig" %}
{% block headline %}Create Style{% endblock %}
{% block content %}

    <!-- Top Toolbar -->
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-colors-navbar-collapse-3">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Options</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-colors-navbar-collapse-3">
                <input id="filebutton" style="float:left;" name="filebutton" type="file" class="filestyle btn" data-buttonText="Import" data-classIcon="glyphicon glyphicon-import" data-input="false" data-classbutton="btn btn-default" value="Import">
                <a href="{{ path('guiDownloadLessVariables') }}" target="_blank" type="button" class="btn btn-default navbar-btn"><span class="glyphicon glyphicon-export"></span> Export</a>
                <button type="button" onclick="resetApplyVariables()" class="btn btn-danger navbar-btn"><span class="glyphicon glyphicon-repeat"></span> Reset</button>
                <button type="button" onclick="lessApplyVariables()" class="btn btn-success navbar-btn"><span class="glyphicon glyphicon-ok"></span> Apply</button>
                <button type="button" class="btn btn-primary navbar-btn" onclick="saveCss()"><span class="glyphicon glyphicon-floppy-disk"></span> Save</button>
            </div>
        </div>
    </nav>

    <!-- Variables form -->
    <form id="less-form" role="form" method="post" action="{{ path('guiApplyLessVariables') }}">
        {{ output|raw }}
    </form>
{% endblock %}

{% block javascripts %}
    <link rel="stylesheet/less" type="text/css" href="{{ asset('bundles/gui/less/bootstrap/bootstrap.less') }}" />
    <script>
        less = {
            env: "development",
            async: false,
            fileAsync: false,
            poll: 1000,
            functions: {},
            dumpLineNumbers: "comments",
            relativeUrls: false,
            rootpath: "{{ asset('bundles/gui/less/bootstrap/') }}"
        };
    </script>
    <script src="{{ asset('bundles/gui/js/less/less-1.7.4.min.js') }}" type="text/javascript"></script>
    <script>
        $("#less-form :input").blur(function() {
            lessApplyVariables();
        });

        function resetApplyVariables()
        {
            $.post( "{{ path('guiResetLessVariables') }}", $( "#less-form" ).serialize()).done(function(){location.reload();});
        }

        function lessApplyVariables()
        {
            $.post( "{{ path('guiApplyLessVariables') }}", $( "#less-form" ).serialize()).done(function(){location.reload();});
        }

        function saveCss()
        {
            //var css = less.tree.toCSS({ compress: true });
            //alert(css);

            $.post("{{ path('guiSaveBootstrapCss') }}").done(function(data){

                    alert(data);
            });

            //var parser = new(less.Parser);
            /*
            var parser = new(less.Parser)({
                paths: ['./' , './mixins'],
                filename: 'bootstrap.less'
            });
            */

            /*
            $.post("{{ path('guiGetBootstrapLess') }}").done(function(data){
                parser.parse(data, function (err, tree) {
                    if (err) { return console.error(err) }
                    var css = tree.toCSS({ compress: true });
                    //console.log(css)

                    alert(css);
                });
            });
            */

        }
    </script>
{% endblock %}